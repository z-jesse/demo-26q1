<div class="analytics-page">
  <header class="analytics-header">
    <h2 class="text-wrapper-7">Analytics</h2>
    <div class="analytics-filters">
      <div class="field analytics-select" data-colors-mode="dark">
        <select class="analytics-select__input" aria-label="Location">
          <option>Studio Number 1</option>
        </select>
      </div>
      <div class="field analytics-select" data-colors-mode="dark">
        <select class="analytics-select__input" aria-label="Date range">
          <option>This Week Aug 4, 2023 – 10, 2024</option>
        </select>
      </div>
      <button type="button" class="frame-11 analytics-apply" data-colors-mode="dark">Apply</button>
      <button type="button" class="frame-11 analytics-action" data-colors-mode="dark"><span class="analytics-action__icon" aria-hidden="true">⋮</span> Action</button>
    </div>
  </header>

  <div class="analytics-kpi-row">
    <section class="frame-15 analytics-kpi-card" data-colors-mode="dark" aria-labelledby="revenue-heading">
      <div class="analytics-card-header">
        <h3 id="revenue-heading" class="text-wrapper-8">Revenue</h3>
        <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
      </div>
      <div id="analytics-revenue-mini" style="height: 80px; width: 100%;"></div>
      <h2 class="text-wrapper-7 analytics-kpi-value">$30,032</h2>
      <p class="analytics-kpi-meta">$22,500 Last Year</p>
    </section>
    <section class="frame-15 analytics-kpi-card" data-colors-mode="dark" aria-labelledby="cost-heading">
      <div class="analytics-card-header">
        <h3 id="cost-heading" class="text-wrapper-8">Cost</h3>
        <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
      </div>
      <div id="analytics-cost-mini" style="height: 80px; width: 100%;"></div>
      <h2 class="text-wrapper-7 analytics-kpi-value">$8,950</h2>
      <p class="analytics-kpi-meta">$7,800 Previously</p>
    </section>
    <section class="frame-15 analytics-kpi-card" data-colors-mode="dark" aria-labelledby="gross-profit-heading">
      <div class="analytics-card-header">
        <h3 id="gross-profit-heading" class="text-wrapper-8">Gross Profit</h3>
        <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
      </div>
      <div id="analytics-gross-mini" style="height: 80px; width: 100%;"></div>
      <h2 class="text-wrapper-7 analytics-kpi-value">$21,082</h2>
    </section>
  </div>

  <section class="frame-15 analytics-chart-card" data-colors-mode="dark" aria-labelledby="visits-heading">
    <div class="analytics-card-header">
      <h3 id="visits-heading" class="text-wrapper-8">Total Visits / New Visits</h3>
      <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
    </div>
    <div class="analytics-legend-inline">
      <span class="analytics-legend-dot analytics-legend-dot--blue"></span> 9,520
      <span class="analytics-legend-dot analytics-legend-dot--red" style="margin-left: 16px;"></span> 1,815
    </div>
    <div id="analytics-visits-chart" style="height: 260px; width: 100%;"></div>
  </section>

  <div class="analytics-mid-row">
    <section class="frame-15 analytics-metrics-card" data-colors-mode="dark" aria-labelledby="core-metrics-heading">
      <div class="analytics-card-header">
        <h3 id="core-metrics-heading" class="text-wrapper-8">Core Metrics</h3>
        <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
      </div>
      <div class="metrics-list metrics-list--two-col">
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Visits</p>
          </div>
          <p class="text-wrapper-10 metric-value">9,520</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">No-shows</p>
          </div>
          <p class="text-wrapper-10 metric-value">190</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Bookings</p>
          </div>
          <p class="text-wrapper-10 metric-value">5,603</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Cancellations</p>
          </div>
          <p class="text-wrapper-10 metric-value">59</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Unique customers</p>
          </div>
          <p class="text-wrapper-10 metric-value">2,824</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Average visits per customer</p>
          </div>
          <p class="text-wrapper-10 metric-value">3.4</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Classes scheduled</p>
          </div>
          <p class="text-wrapper-10 metric-value">309</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Average capacity filled</p>
          </div>
          <p class="text-wrapper-10 metric-value">44%</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Total Memberships</p>
          </div>
          <p class="text-wrapper-10 metric-value">486</p>
        </div>
        <div class="metric-item">
          <div class="metric-label-row">
            <p class="metric-label">Total Bundles</p>
          </div>
          <p class="text-wrapper-10 metric-value">132</p>
        </div>
      </div>
    </section>
    <section class="frame-15 analytics-chart-card" data-colors-mode="dark" aria-labelledby="bookings-heading">
      <div class="analytics-card-header">
        <h3 id="bookings-heading" class="text-wrapper-8">Total Bookings</h3>
        <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
      </div>
      <p class="analytics-chart-summary">5,603</p>
      <div id="analytics-bookings-chart" class="analytics-chart-container" style="min-height: 200px; width: 100%;"></div>
    </section>
    <section class="frame-15 analytics-chart-card" data-colors-mode="dark" aria-labelledby="members-heading">
      <div class="analytics-card-header">
        <h3 id="members-heading" class="text-wrapper-8">Total Members / Total Bundles</h3>
        <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
      </div>
      <div class="analytics-legend-inline">
        <span class="analytics-legend-dot analytics-legend-dot--blue"></span> 486
        <span class="analytics-legend-dot analytics-legend-dot--red" style="margin-left: 16px;"></span> 132
      </div>
      <div id="analytics-members-chart" class="analytics-chart-container" style="min-height: 200px; width: 100%;"></div>
    </section>
  </div>

  <div class="analytics-bottom-row">
    <section class="frame-15 analytics-chart-card" data-colors-mode="dark" aria-labelledby="visit-dist-heading">
      <div class="analytics-card-header">
        <h3 id="visit-dist-heading" class="text-wrapper-8">Visit Distribution (Day × Week)</h3>
        <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
      </div>
      <p class="analytics-chart-summary">9520 Total Visits</p>
      <div id="analytics-heatmap" style="height: 320px; width: 100%;"></div>
    </section>
    <section class="frame-15 analytics-chart-card analytics-donut-card" data-colors-mode="dark" aria-labelledby="retention-heading">
      <div class="analytics-card-header">
        <h3 id="retention-heading" class="text-wrapper-8">Customer Retention</h3>
        <button type="button" class="analytics-card-menu" aria-label="Options">⋯</button>
      </div>
      <div id="analytics-retention-donut" style="height: 280px; width: 100%;"></div>
    </section>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min@3.3.1/plotly.min.js"></script>
<script>
(function () {
  var tickFont = { color: "rgba(122, 122, 122, 1)", size: 12, family: "Figtree" };
  var layoutBase = {
    margin: { t: 0, r: 0, b: 28, l: 44 },
    autosize: true,
    paper_bgcolor: "rgba(0,0,0,0)",
    plot_bgcolor: "rgba(0,0,0,0)",
    xaxis: { tickfont: tickFont, showgrid: false, zeroline: false },
    yaxis: { tickfont: tickFont, gridcolor: "rgba(61, 61, 61, 1)", zeroline: false },
    showlegend: false
  };

  function resizeAll() {
    [ "analytics-revenue-mini", "analytics-cost-mini", "analytics-gross-mini",
      "analytics-visits-chart", "analytics-bookings-chart", "analytics-members-chart",
      "analytics-heatmap", "analytics-retention-donut" ].forEach(function (id) {
        var el = document.getElementById(id);
        if (el && typeof Plotly !== "undefined") try { Plotly.Plots.resize(el); } catch (e) {}
      });
  }

  // Revenue mini (line, up) — matches dashboard Total sales chart data
  (function () {
    var el = document.getElementById("analytics-revenue-mini");
    if (!el) return;
    var x = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19];
    var y = [770, 800, 670, 820, 840, 880, 940, 820, 1030, 940, 1100, 1150, 1030, 1180, 1190, 1080, 1210, 1220, 1130, 1250];
    var layout = Object.assign({}, layoutBase, { margin: { t: 0, r: 0, b: 0, l: 28 } });
    Plotly.newPlot(el, [{
      x: x, y: y, type: "scatter", mode: "lines", fill: "tozeroy",
      fillcolor: "rgba(4, 152, 224, 0.4)",
      fillgradient: {
        type: "vertical",
        colorscale: [[0, "rgba(4, 152, 224, 0)"], [1, "rgba(4, 152, 224, 0.3)"]]
      },
      line: { color: "#0498e0", width: 2 }
    }], layout, { responsive: true, displayModeBar: false });
  })();

  // Cost mini (area) — fixed costs: low variation, flattens at end
  (function () {
    var el = document.getElementById("analytics-cost-mini");
    if (!el) return;
    var x = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19];
    var y = [268, 272, 270, 275, 278, 280, 282, 281, 285, 286, 288, 290, 291, 292, 292, 293, 293, 293, 293, 293];
    var layout = Object.assign({}, layoutBase, { margin: { t: 0, r: 0, b: 0, l: 28 } });
    Plotly.newPlot(el, [{
      x: x, y: y, type: "scatter", mode: "lines", fill: "tozeroy",
      fillcolor: "rgba(254, 89, 21, 0.25)",
      fillgradient: {
        type: "vertical",
        colorscale: [[0, "rgba(254, 89, 21, 0)"], [1, "rgba(254, 89, 21, 0.25)"]]
      },
      line: { color: "rgba(254, 89, 21, 1)", width: 2 }
    }], layout, { responsive: true, displayModeBar: false });
  })();

  // Gross profit mini (line) — Revenue − Cost per period
  (function () {
    var el = document.getElementById("analytics-gross-mini");
    if (!el) return;
    var revenueY = [770, 800, 670, 820, 840, 880, 940, 820, 1030, 940, 1100, 1150, 1030, 1180, 1190, 1080, 1210, 1220, 1130, 1250];
    var costY = [268, 272, 270, 275, 278, 280, 282, 281, 285, 286, 288, 290, 291, 292, 292, 293, 293, 293, 293, 293];
    var x = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19];
    var y = revenueY.map(function (r, i) { return r - costY[i]; });
    var layout = Object.assign({}, layoutBase, { margin: { t: 0, r: 0, b: 0, l: 28 } });
    Plotly.newPlot(el, [{
      x: x, y: y, type: "scatter", mode: "lines", fill: "tozeroy",
      fillcolor: "rgba(4, 152, 224, 0.4)",
      fillgradient: {
        type: "vertical",
        colorscale: [[0, "rgba(4, 152, 224, 0)"], [1, "rgba(4, 152, 224, 0.3)"]]
      },
      line: { color: "#0498e0", width: 2 }
    }], layout, { responsive: true, displayModeBar: false });
  })();

  // Total Visits / New Visits (Jan–Jun)
  (function () {
    var el = document.getElementById("analytics-visits-chart");
    if (!el) return;
    var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun"];
    var totalVisits = [1180, 1520, 1390, 1780, 1640, 2010];
    var newVisits = [210, 305, 250, 355, 295, 400];
    var layout = Object.assign({}, layoutBase, {
      xaxis: { tickvals: [0,1,2,3,4,5], ticktext: months, tickfont: tickFont, showgrid: false, automargin: true },
      yaxis: { tickfont: tickFont, gridcolor: "rgba(61, 61, 61, 1)", tickformat: ",.0f", dtick: 1000, automargin: true }
    });
    Plotly.newPlot(el, [
      { x: months, y: totalVisits, type: "scatter", mode: "lines", name: "Total Visits", fill: "tozeroy",
        fillcolor: "rgba(4, 152, 224, 0.4)",
        fillgradient: { type: "vertical", colorscale: [[0, "rgba(4, 152, 224, 0)"], [1, "rgba(4, 152, 224, 0.3)"]] },
        line: { color: "#0498e0", width: 2 } },
      { x: months, y: newVisits, type: "scatter", mode: "lines", name: "New Visits", fill: "tozeroy",
        fillcolor: "rgba(254, 89, 21, 0.25)",
        fillgradient: { type: "vertical", colorscale: [[0, "rgba(254, 89, 21, 0)"], [1, "rgba(254, 89, 21, 0.25)"]] },
        line: { color: "rgba(254, 89, 21, 1)", width: 2 } }
    ], layout, { responsive: true, displayModeBar: false });
  })();

  // Total Bookings (area, dates)
  (function () {
    var el = document.getElementById("analytics-bookings-chart");
    if (!el) return;
    var dates = ["08/05", "08/11", "08/18", "08/25", "09/01"];
    var y = [800, 1200, 1100, 1500, 1003];
    var layout = Object.assign({}, layoutBase, {
      margin: { t: 0, r: 8, b: 8, l: 36 },
      xaxis: { tickvals: dates, tickfont: tickFont, showgrid: false, automargin: true },
      yaxis: { tickfont: tickFont, gridcolor: "rgba(61, 61, 61, 1)", dtick: 1000 }
    });
    Plotly.newPlot(el, [{
      x: dates, y: y, type: "scatter", mode: "lines", fill: "tozeroy",
      fillcolor: "rgba(4, 152, 224, 0.4)",
      fillgradient: {
        type: "vertical",
        colorscale: [[0, "rgba(4, 152, 224, 0)"], [1, "rgba(4, 152, 224, 0.3)"]]
      },
      line: { color: "#0498e0", width: 2 }
    }], layout, { responsive: true, displayModeBar: false });
  })();

  // Total Members / Bundles (two lines)
  (function () {
    var el = document.getElementById("analytics-members-chart");
    if (!el) return;
    var dates = ["08/05", "08/11", "08/18", "08/25", "09/01"];
    var members = [420, 440, 455, 470, 486];
    var bundles = [100, 110, 118, 125, 132];
    var layout = Object.assign({}, layoutBase, {
      margin: { t: 0, r: 8, b: 8, l: 36 },
      xaxis: { tickvals: dates, tickfont: tickFont, showgrid: false, automargin: true },
      yaxis: { tickfont: tickFont, gridcolor: "rgba(61, 61, 61, 1)" }
    });
    Plotly.newPlot(el, [
      { x: dates, y: members, type: "scatter", mode: "lines", name: "Members", fill: "tozeroy",
        fillcolor: "rgba(4, 152, 224, 0.4)",
        fillgradient: { type: "vertical", colorscale: [[0, "rgba(4, 152, 224, 0)"], [1, "rgba(4, 152, 224, 0.3)"]] },
        line: { color: "#0498e0", width: 2 } },
      { x: dates, y: bundles, type: "scatter", mode: "lines", name: "Bundles", fill: "tozeroy",
        fillcolor: "rgba(254, 89, 21, 0.25)",
        fillgradient: { type: "vertical", colorscale: [[0, "rgba(254, 89, 21, 0)"], [1, "rgba(254, 89, 21, 0.25)"]] },
        line: { color: "rgba(254, 89, 21, 1)", width: 2 } }
    ], layout, { responsive: true, displayModeBar: false });
  })();

  // Visit Distribution heatmap (Day × Week)
  (function () {
    var el = document.getElementById("analytics-heatmap");
    if (!el) return;
    var days = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"];
    var hours = ["6 AM", "7 AM", "8 AM", "9 AM", "10 AM", "11 AM", "12 PM", "1 PM", "2 PM", "3 PM", "4 PM", "5 PM", "6 PM"];
    function heatmapNoise(d, h) {
      var n = (d * 13 + h) * 12.9898;
      return ((n * Math.sin(n) * 43758.5453) % 1);
    }
    var z = [];
    for (var h = 0; h < 13; h++) {
      var row = [];
      var isPeakMorning = h >= 0 && h <= 3;
      var isLunchDip = h >= 5 && h <= 7;
      var isAfternoon = h >= 8 && h <= 10;
      var isEveningBump = h >= 11 && h <= 12;
      for (var d = 0; d < 7; d++) {
        var isWeekend = d === 0 || d === 6;
        var base = isWeekend ? 35 : 22;
        if (isPeakMorning) base += isWeekend ? 55 : 38;
        else if (isLunchDip) base -= 12;
        else if (isAfternoon) base += 15;
        else if (isEveningBump) base += 18;
        var noise = (heatmapNoise(d, h) - 0.5) * 24;
        row.push(Math.max(8, Math.min(98, Math.round(base + noise))));
      }
      z.push(row);
    }
    var layout = Object.assign({}, layoutBase, {
      margin: { t: 8, r: 8, b: 36, l: 56 },
      xaxis: { tickvals: days.map(function(_, i) { return i; }), ticktext: days, side: "bottom", tickfont: tickFont, showline: false, showgrid: false },
      yaxis: { tickvals: hours.map(function(_, i) { return i; }), ticktext: hours, tickfont: tickFont, showline: false, showgrid: false },
      font: { family: "Figtree" }
    });
    Plotly.newPlot(el, [{
      z: z, x: days, y: hours, type: "heatmap",
      colorscale: [[0, "rgba(4, 152, 224, 0.15)"], [0.5, "rgba(4, 152, 224, 0.5)"], [1, "rgba(4, 152, 224, 0.9)"]],
      showscale: false
    }], layout, { responsive: true, displayModeBar: false });
  })();

  // Customer Retention donut
  (function () {
    var el = document.getElementById("analytics-retention-donut");
    if (!el) return;
    var layout = Object.assign({}, layoutBase, {
      margin: { t: 0, r: 0, b: 0, l: 0 },
      annotations: [{ text: "2,297<br>Total Customers", showarrow: false, font: { size: 14, family: "Figtree", color: "rgba(255,255,255,1)" } }]
    });
    Plotly.newPlot(el, [{
      values: [920, 690, 687],
      labels: ["Retained", "Churned", "New"],
      type: "pie",
      hole: 0.65,
      marker: { colors: ["#0498e0", "rgba(254, 89, 21, 0.9)", "rgba(142, 36, 170, 0.9)"] },
      textinfo: "none",
      hoverinfo: "label+value+percent"
    }], layout, { responsive: true, displayModeBar: false });
  })();

  window.addEventListener("resize", resizeAll);
  if (typeof ResizeObserver !== "undefined") {
    var ro = new ResizeObserver(function () { setTimeout(resizeAll, 0); });
    var wrap = document.querySelector(".analytics-page");
    if (wrap) ro.observe(wrap);
  }
  setTimeout(resizeAll, 100);
})();
</script>
